<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Descent</title>
    <style>
        @font-face {
            font-family: 'TronFont';
            src: url('tron.ttf');
        }

        body {
            margin: 0;
            padding: 0;
            background: url("staircase.jpg") no-repeat center center fixed;
            background-size: cover;
            height: 100vh;
            overflow: hidden;
            background-color: black;
        }

        /* The Flashlight Overlay - Starts completely black */
        #flashlight {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; 
            z-index: 100; 
            background: black; 
            transition: background 0.1s;
        }

        .door-target {
            position: absolute;
            left: 560px;
            top: 270px;
            width: 80px;
            height: 110px;
            cursor: pointer;
            z-index: 5;
            display: none; 
            border: 2px solid #00ffff;
            box-shadow: 0 0 15px #00ffff;
            background: rgba(0, 255, 255, 0.1);
        }

        .dialogue-box {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ffff;
            padding: 25px;
            box-sizing: border-box;
            text-align: center;
            z-index: 110;
        }

        .system-label {
            font-family: 'TronFont', sans-serif;
            color: #00ffff;
            font-size: 1rem;
            margin-bottom: 10px;
        }

        #text-content {
            color: white;
            font-family: sans-serif;
            font-size: 1.3rem;
            margin: 0;
        }

        .btn-container { 
            display: none; /* Hidden until the light is on */
            justify-content: center; 
            gap: 20px; 
            margin-top: 20px;
        }

        .btn {
            background: transparent;
            border: 1px solid #00ffff;
            color: #00ffff;
            padding: 10px 25px;
            font-family: 'TronFont', sans-serif;
            cursor: pointer;
        }

        .btn:hover { background: #00ffff; color: black; }

        @keyframes flicker {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }
        .apply-flicker { animation: flicker 0.5s ease-in-out; }
    </style>
</head>
<body onload="playStartSound()">

    <div id="flashlight"></div>

    <audio id="doorOpen" src="door opening.mp3"></audio>
    <audio id="doorSlam" src="door closing.mp3"></audio>

    <div id="door" class="door-target" onclick="window.location.href='page4.html'"></div>

    <div class="dialogue-box">
        <div class="system-label">SYSTEM_STATUS: SENSORS OFFLINE</div>
        <p id="text-content">It's so dark... Let's use our torchlight.</p>
        
        <div id="choice-buttons" class="btn-container">
            <button class="btn" onclick="handleChoice('yes')">YES</button>
            <button class="btn" onclick="handleChoice('no')">NO</button>
        </div>
    </div>

    <script>
        const openSound = document.getElementById('doorOpen');
        const slamSound = document.getElementById('doorSlam');
        const flashlight = document.getElementById('flashlight');
        const textContent = document.getElementById('text-content');
        const btnContainer = document.getElementById('choice-buttons');
        
        let lightInitialized = false;

        function playStartSound() {
            openSound.play().catch(e => console.log("Waiting for user..."));
        }

        // Mouse Tracker
        window.addEventListener('mousemove', e => {
            // First time the mouse moves, "turn on" the game
            if (!lightInitialized) {
                lightInitialized = true;
                textContent.innerText = "You discover a flight of stairs. Do you want to descend?";
                btnContainer.style.display = "flex";
                document.querySelector('.system-label').innerText = "LOCATION: UNKNOWN";
            }

            // Update Flashlight position
            flashlight.style.background = `radial-gradient(circle 150px at ${e.clientX}px ${e.clientY}px, transparent 0%, rgba(0, 0, 0, 0.98) 100%)`;
        });

        function handleChoice(choice) {
            const door = document.getElementById('door');

            if (choice === 'yes') {
                textContent.innerText = "The depths await. Use your light to find the way out...";
                btnContainer.style.display = "none";
                door.style.display = "block";
            } else {
                slamSound.play();
                flashlight.classList.add('apply-flicker');
                textContent.innerText = "The door slams shut behind you! There is no turning back now.";
                textContent.style.color = "#ff4444";
                btnContainer.style.display = "none";

                setTimeout(() => {
                    door.style.display = "block";
                    flashlight.classList.remove('apply-flicker');
                }, 1000);
            }
        }
    </script>
</body>
</html>