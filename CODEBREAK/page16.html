<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Farewell</title>
    <style>
        @font-face { font-family: 'TronFont'; src: url('tron.ttf'); }
        body { 
            margin: 0; padding: 0; 
            background: url("core.jpg") no-repeat center center fixed; 
            background-size: cover; height: 100vh; overflow: hidden; background-color: #000; 
        }

        /* The Flash Overlay */
        #flash-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: white;
            opacity: 0;
            pointer-events: none; /* Allows clicking through until active */
            z-index: 100;
            transition: opacity 0.8s ease-in;
        }

        #mei-sprite { 
            position: absolute; bottom: 15%; left: 50%;
            transform: translateX(-50%); height: 70vh; 
            z-index: 5; object-fit: contain;
            filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.3));
        }

        .dialogue-box { 
            position: absolute; bottom: 20px; left: 50%;
            transform: translateX(-50%); width: 60%; 
            background: rgba(0, 5, 15, 0.9); 
            border: 2px solid #ff00ff; 
            box-shadow: 0 0 20px #ff00ff; 
            padding: 25px; z-index: 10; backdrop-filter: blur(10px);
        }

        .speaker-heading { 
            font-family: 'TronFont', sans-serif; color: #ff00ff; 
            margin-bottom: 10px; font-size: 1rem; letter-spacing: 2px;
        }

        #text-content { 
            color: #e0ffff; font-family: 'Segoe UI', sans-serif; 
            font-size: 1.15rem; line-height: 1.6; min-height: 5em;
        }

        .btn { 
            background: transparent; border: 1px solid #00ffff; 
            color: #00ffff; padding: 10px 25px; 
            font-family: 'TronFont', sans-serif; 
            cursor: pointer; margin-top: 15px; display: none;
        }
        .btn:hover { background: #00ffff; color: black; box-shadow: 0 0 15px #00ffff; }
    </style>
</head>
<body>

    <div id="flash-overlay"></div>

    <img src="emotional.png" id="mei-sprite" alt="Mei's Farewell">

    <div class="dialogue-box">
        <div class="speaker-heading">MEI</div>
        <div id="text-content"></div>
        <button class="btn" id="exit-btn" onclick="triggerFlash()">DISCONNECT & RETURN HOME</button>
    </div>

    <script>
        const pName = localStorage.getItem("playerTagName") || "User";
        const textElement = document.getElementById('text-content');
        const exitBtn = document.getElementById('exit-btn');
        const flash = document.getElementById('flash-overlay');

        const message = pName + ". Never forget that out there, just like in here, not everything is what it seems. Thank you for helping me save the Grid. It's time for you to return home.";

        let i = 0;
        function typeWriter() {
            if (i < message.length) {
                textElement.innerHTML += message.charAt(i);
                i++;
                setTimeout(typeWriter, 30);
            } else {
                exitBtn.style.display = "inline-block";
            }
        }

        function triggerFlash() {
            // Start the white flash
            flash.style.opacity = "1";
            
            // Wait for the flash to cover the screen, then change page
            setTimeout(() => {
                window.location.href = 'page17.html';
            }, 800); // This matches the 0.8s transition in CSS
        }

        window.onload = typeWriter;
    </script>
</body>
</html>